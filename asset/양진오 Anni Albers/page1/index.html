<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Page N</title>
    <style>
      body {
        padding: 0;
        margin: 0;
        background-color: #1b1b1b;
        touch-action: none;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <div id="ui-root">
      <div id="tabs"></div>
      <div id="controls"></div>
      <div id="panel"></div>
    </div>
    <style>
      body {
        padding: 0;
        margin: 0;
        background-color: #1b1b1b;
        touch-action: none;
        overflow: hidden;
      }
    </style>

    <script defer src="../lib/p5.min.js"></script>
    <script defer src="../lib/p5.sound.js"></script>
    <script defer src="../lib/matter.min.js"></script>

    <script defer src="./section0_quarter.js"></script>

    <script defer>
      (function forceFirstTo(targetName, realName) {
        function resolve() {
          return window[realName] || window[targetName];
        }
        function asCallable() {
          return function (...args) {
            const Impl = resolve();
            if (!Impl) {
              console.error(
                "Section impl not loaded yet:",
                targetName,
                realName
              );
              return {};
            }
            try {
              return Impl(...args);
            } catch {
              return new Impl(...args);
            }
          };
        }
        window.Section0_QuarterWeave = asCallable();
        window[targetName] = asCallable();
      })(
        "SectionX_Target", //  core가 기대하는 이름
        "SectionX_Target" //  실제 섹션 파일이 내보내는 전역 이름
      );
    </script>

    <script defer>
      window.createTabs =
        window.createTabs ||
        function (labels = [], onSelect) {
          const root = document.getElementById("tabs") || document.body;
          root && (root.innerHTML = "");
          const api = { setActive() {}, destroy() {} };
          if (root && root !== document.body) {
            labels.forEach((t, i) => {
              const b = document.createElement("button");
              b.className = "tab";
              b.textContent = String(t ?? `Tab ${i + 1}`);
              b.addEventListener("click", () => onSelect && onSelect(i));
              root.appendChild(b);
            });
            api.setActive = (i) =>
              [...root.querySelectorAll(".tab")].forEach((el, idx) =>
                el.classList.toggle("active", idx === i)
              );
            api.destroy = () => {
              root.innerHTML = "";
            };
          }
          return api;
        };
    </script>

    <script defer src="../app/core.js"></script>

    <script defer>
      (function forceFirstTo(targetName, realName) {
        function resolve() {
          return window[realName] || window[targetName];
        }

        function asCallable() {
          return function (...args) {
            const Impl = resolve();
            if (!Impl) {
              console.error(
                "Section impl not loaded yet:",
                targetName,
                realName
              );
              return {};
            }
            try {
              return Impl(...args);
            } catch {
              return new Impl(...args);
            }
          };
        }

        window.Section0_QuarterWeave = asCallable();

        window[targetName] = asCallable();

        //  에러 방지
        [
          "Section0_QuarterWeave",
          "Section1_LoomGrid",
          "Section2_WeftRipple",
          "Section3_ShuttleChannels",
          "Section4_PatternTiles",
        ].forEach((n) => {
          if (!window[n])
            window[n] = function () {
              return {};
            };
        });
      })("Section0_QuarterWeave", "Section0_QuarterWeave");
    </script>

    <script defer src="../app/core.js"></script>
  </body>
</html>
